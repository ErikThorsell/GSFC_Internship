# Calculate Slew

A simple way to calculate the slew time for an arbitrary VLBI (AZ/EL) antenna.


## Requirements

- A folder that contains the .log-files as well as the .azel-file for an
  arbitrary session. The log files should be named ``<session>.log`` and the
  azel file ``<session>.azel``. The creation of the azel files are explained
  in section `Generate .azel`.

    - **Note:** Defining the path as ``/500/year/*`` will give the result for
      all sessions in that year if * can be substituted for a session folder.
      This is the "higest level" possible at the moment. ``/500/*`` is not a
      valid path.

- That trakl or flagr is turned on for the antenna.

- An up-to-date version of the file ``antenna.cat`` that holds a sumary of all
  the antennas' specifications. This file should be placed in ``src/``, or the
  path in calculate_slew.sh should be changed.

- The Python library [numpy](http://www.numpy.org/, "Numpy") in order to find
  the least square solution.

- The Python library [mathplotlib](http://matplotlib.org/, "Mathplotlib") in
  order to utilize the ``--graph`` flag and get good looking graphs. (More
  about this below.)



## Run the program

``bash calculate_slew.sh``, runs the program and presents the user with the
--help output.

Usage: bash calculate_slew.sh [FLAG] [FILE]

You must specify at least the session(s) path (-i). If you choose to use any
other flags, the -i|--input flag must be positioned last!

### Flags

The valid flags are:
* -g, --graph    Enable plotting of graphs (req. matplotlib).
* -i, --input    Path to where the session(s) are.
* -o, --output   Path to where you wish to store the output data.
* -h, --help     Prints this help.


### House keeping

There are two programs that run before ``./calculate_slew.sh``.

1. ``src/getStationSpecs.py`` pulls the antennas' specifications from the file
   ``antenna.cat``.

2. ``src/create_extract.py`` also uses ``antenna.cat``, it creates the file
   ``extract.py`` and ensures all the antennas in ``antenna.cat`` can be used.

**Note:** If you have limited disk space, or are simply reluctant to waste
space and time, remove the antennas not in use from *your copy of*
``antenna.cat`` before running the scripts above.

## Output from the program

The program stores two ``.dat``-files for each antenna. The files are named
``<station>_az.dat`` and ``<station>_el.dat`` depending on if azimuth or
elevation is calculated. ``data/`` also contains the file ``lsq_result.dat``
which holds the desired least square solution for each antenna, i.e. the
antenna speed and offset.

If the user wishes to generate graphs all of the above is true, but the program
also stores graphs showing the solution for each antenna - both in azimuth and
elevation. These graphs are stored in ``img/``.

## Generate .azel

The ``.azel``-files are generated by the following commands:

``$> sked <session>.skd``

``sked> xl wrap``

``sked> unit <session>.azel``

``sked> li ^-*``

``sked> q``

``$> mv <session>.azel /path/to/calculate_slew/skds/``

This can be done automatically, and the script will do so if a .azel file is
not found in the session directory at runtime.

