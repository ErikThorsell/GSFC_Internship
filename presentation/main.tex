\documentclass{beamer}
\usepackage{caption}
\usepackage{subfigure}
\usetheme[background=light]{metropolis}

\title{Examining different I/O methods in globl/solve to enhance performance
and improving slew rate models for IVS antennas}
\date{2016-08-18}
\author{Lina Olandersson, Erik Thorsell, Simon Strandberg}
\institute{Created for NVI Inc. at the Goddard Space Flight Centre}

\begin{document}
    \maketitle

    \begin{frame}{Table of Contents}
    \tableofcontents
    \end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

    \section{Learning Fortran}

    \begin{frame}{Calculator}
        \begin{figure}[ht]
            \centering
            \includegraphics[width=1\columnwidth]{calculator}
            \caption{Example usage of the TCP calculator.}
        \end{figure}
    \end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

    \section{Our First Project}

    \begin{frame}{Problem Description}
        Rewrite how globl/solve handles its passing of data to and from
        usrpartials and usrprogs.

        By minimizing disc I/O we want to increase the speed at which data is
        sent.
    \end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    \section{Testing I/O performance}

    \begin{frame}{I/O Performance}
    Protocols we have tried and used:
    \pause
    \begin{itemize}[<+-|alert@+>]
        \item Using the hard drive:
            \begin{itemize}
                \item Read/Write to \textbf{file}
                \item Sending/Receiving with \textbf{pipes}
            \end{itemize}
        \item Using the memory:
            \begin{itemize}[<+-|alert@+>]
                \item Sending/Receiving with \textbf{TCP/IP} Sockets
                \item Sending/Receiving with \textbf{OpenMPI}
                \item Sending/Receiving with \textbf{ZeroMQ}
            \end{itemize}
    \end{itemize}
    \end{frame}
%%
    \begin{frame}{Performance Test}
        \begin{enumerate}[<+-|alert@+>]
            \item The producer generates a list of length n and fills it with
                  integers.
            \item The producer writes the list to file (or sends it over the
                  designated transfer protocol).
            \item The consumer reads (or receives) the list.
            \item The consumer squares each int in the list and sends it back
                  to the producer.
            \item The producer reads (or receives) the modified list.
        \end{enumerate}
    \end{frame}
%%
    \begin{frame}{Result for I/O Performance}
    \begin{figure}[h!]
        \centering
        \includegraphics[width=1\columnwidth]{singlerun-nf}
    \end{figure}
    \end{frame}
%%
    \begin{frame}{Result for I/O Performance}
    \begin{figure}[h!]
        \centering
        \includegraphics[width=1\columnwidth]{thousandrun+files-nf}
    \end{figure}
    \end{frame}
%%
    \begin{frame}{Result for I/O Performance}
    \begin{figure}[h!]
        \centering
        \includegraphics[width=1\columnwidth]{thousandrun-nf}
    \end{figure}
    \end{frame}
%%
    \begin{frame}{Result for I/O Performance}
    \begin{itemize}[<+-|alert@+>]
        \item TCP was the fastest, but the most difficult to implement.
        \item Since we assumed a lot of data would be passed we opted for ZeroMQ
              due to its presumptive ease of use and performance.
    \end{itemize}
    \end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

    \section{Implementation}

    \begin{frame}{Implementation}
    \begin{itemize}[<+-|alert@+>]
        \item Installation of ZeroMQ on \bf{bootes}
        \item Porting our code to a different compiler: gfortran $\rightarrow$ ifort
        \item Understanding where to put what and why
        \item A lot of coding
    \end{itemize}
    \end{frame}
%%
    \begin{frame}{Implementation}
        \begin{figure}[h!]
        \centering
        \begin{minipage}{.5\columnwidth}
            \begin{itemize}
                \item ZeroMQ
                \pause
                \begin{itemize}[<+-|alert@+>]
                    \item child\_com.f
                    \item parent\_com.f
                \end{itemize}
            \end{itemize}
        \end{minipage}%
        \begin{minipage}{.5\columnwidth}
            \centering
            \includegraphics[width=1\columnwidth]{child_com}
        \end{minipage}
        \end{figure}
    \end{frame}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

    \section{Results for Project One}

    \begin{frame}{Results for Project One}
        \begin{description}[<+-|alert@+>]
            \item Running userpartials for $\sim$200 observations.
            \item Old version of globl/solve: 8 minutes 47 seconds
            \item New version of globl/solve: 9 minutes 5 seconds
        \end{description}
    \end{frame}
%%
    \begin{frame}{Results for Project One}
        \centering{Why?}
    \end{frame}
%%
    \begin{frame}{Results for Project One}
        Globl/solve does not \emph{read and write} a lot, it \bf{reads} a lot,
        \centering
        \includegraphics[width=1\columnwidth]{thousandrun}

        but read only is still slower...
    \end{frame}
%%
    \begin{frame}{Results for Project One}
        Globl/solve does not read as much as we thought.
        \centering
        \includegraphics[width=1\columnwidth]{singlerun}
    \end{frame}
%%
    \begin{frame}{Results for Project One}
        Maybe not all in vain:
        \pause
        \begin{itemize}[<+-|alert@+>]
            \item ZeroMQ can be used for concurrency (parallel programming)
            \item We only calculate user partials, what about user programs?
        \end{itemize}
    \end{frame}
%%
    \begin{frame}{Future studies}
        \begin{itemize}[<+-|alert@+>]
            \item Remove the writes that are no longer needed.
            \item TCP should have been the way to go?
            \item Posix Shared Memory?
            \begin{itemize}[<+-|alert@+>]
                \item Conversion between C and Fortran was non trivial.
            \end{itemize}
        \end{itemize}
    \end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

    \section{Our Second Project}

    \begin{frame}{Problem Description}
        The model used for determining when an antenna acquires a source is a
        little bit off. Sked will say that an antenna should be on target at
        time $T$ but the logfiles tells us that the antenna actually was on
        source at $T \pm c$.
    \end{frame}
%%
    \begin{frame}{Extract the Data}
        \centering
        \includegraphics[width=1\columnwidth]{skds}\\[2ex]
        \includegraphics[width=0.75\columnwidth]{logs}
    \end{frame}
%%
    \begin{frame}{Parse the Data}
        \begin{itemize}[<+-|alert@+>]
            \item Correlate the log data with the Sked data.
            \item Least Square Fit
        \end{itemize}
    \end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

    \section{Result for Project Two}

%   lista Ã¶ver r17 och stationer

    \begin{frame}{Sessions and stations}
        \begin{columns}[T] % align columns
            \begin{column}{.48\textwidth}
            \color{black}\rule{\linewidth}{4pt}
                Sessions used:
                \begin{itemize}
                    \item r1727
                    \item r1729
                    \item r1735
                    \item r1746
                    \item r1747
                \end{itemize}

        \end{column}
        \hfill
        \begin{column}{.48\textwidth}
           \rule{\linewidth}{4pt}
                Stations in sessions:
                \begin{itemize}
                    \item Fortleza
                    \item Hart15m
                    \item Hobart12
                    \item Ishioka
                    \item Kashim34
                    \item Kath12m
                    \item Kokee
                    \item Matera
                    \item Nyales20
                    \item Onsala60
                    \item Sejong
                    \item Tsukub32
                    \item Yarra12m
                \end{itemize}

        \end{column}%
    \end{columns}
    \end{frame}
%%
    \begin{frame}{Extracted data points}
        \centering
        \includegraphics[width=1\columnwidth]{HOBART12_AZIMUT_DATA}
    \end{frame}
%%
    \begin{frame}{Calculated model}
        \centering
        \includegraphics[width=1\columnwidth]{HOBART12_AZIMUT}
    \end{frame}
%%
    \begin{frame}{Result for Project two}
        \begin{tabular}{l c c c c c}
            Antenna & $\Delta$Azimuth & $\Delta$Offset & & $\Delta$Elevation & $\Delta$Offset\\ [-8pt]
               & \tiny{[deg/min]}      & \tiny{[s]}            & & \tiny{[deg/min]} & \tiny{[s]} \\
            \hline
            Fortleza          & +8  & \textcolor{red}{+22.6} &  & 0  &\textcolor{red}{+13.3}  \\
            Hart15m           & +4  & \textcolor{red}{+5.3}  &  & \textcolor{red}{-2} &\textcolor{red}{+5.0}   \\
            Hobart12          & +1  & \textcolor{red}{+7.7}  &  & +1&\textcolor{red}{+6.2}   \\
            Ishioka           & +6  & -0.5  &  & +3 & -0.1   \\
            Kashim34          & +4  & \textcolor{red}{+12.0} &  & +1 &\textcolor{red}{+11.6}  \\
            Kath12m           & +1  & \textcolor{red}{+6.6}  &  & 0 &\textcolor{red}{+5.7}   \\
            Kokee             & +12 & -1.4  &  & +24&-4.2   \\
            Matera            & +15 & \textcolor{red}{+20.6} &  & +54&\textcolor{red}{+13.5}  \\
            Nyales20          & +16 & \textcolor{red}{+5.8}  &  & +16& -0.8  \\
            Onsala60          & +42 & -0.1  &  & +3 &-4.7   \\
            Sejong            & +17 & \textcolor{red}{+30.5} &  &\textcolor{red}{-64}& \textcolor{red}{+23.1}  \\
            Tsukub32          & +15 & \textcolor{red}{+3.9}  &  & +7 &\textcolor{red}{+1.3}   \\
            Yarra12m          & +1  & \textcolor{red}{+6.9}  &  & 0  &\textcolor{red}{+6.4}   \\
        \end{tabular}
    \end{frame}
%%
    \begin{frame}{Mirrored data points}
        \begin{itemize}[<+-|alert@+>]
            \item Some stations has a line of additional data points mirrored
            in the 180 degree line.
            \item Probably due to a bug in sked.
            \item Stations: Ishioka, Kath12m, Sejong and Yarra12m
        \end{itemize}
    \end{frame}
%%
    \begin{frame}{Extracted data points}
        \centering
        \includegraphics[width=1\columnwidth]{ISHIOKA_AZIMUT_DATA}
    \end{frame}
%%
    \begin{frame}{Calculated model}
        \centering
        \includegraphics[width=1\columnwidth]{ISHIOKA_AZIMUT}
    \end{frame}

%%
    \begin{frame}{Iteration of Least Square Fit}
        \begin{figure}[htp] % not h only
        \centering
        \subfigure{%
            \includegraphics[width=0.4\textwidth]{is_az_1}%
        }\hfil
        \subfigure{%
            \includegraphics[width=0.4\textwidth]{is_az_3}%
        }

        \subfigure{%
            \includegraphics[width=0.4\textwidth]{is_az_5}%
        }\hfil
        \subfigure{%
            \includegraphics[width=0.4\textwidth]{ISHIOKA_AZIMUT}%
        }
%        \caption{Q metric plotted against time}
        \end{figure}
    \end{frame}
%%
    \begin{frame}{Future studies}
        \begin{itemize}[<+-|alert@+>]
            \item Fix the bug in Sked.
            \item Set a more intelligent threshold.
        \end{itemize}
    \end{frame}

    \begin{frame}{Questions?}
        \centering
        Questions?
    \end{frame}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%    \section{Returning Home}
%
%    \begin{frame}{Returning Home}
%        During our time here we have:
%        \pause
%        \begin{itemize}[<+-|alert@+>]
%            \item been exposed to how it is to work at NASA and NVI.
%            \item learned the importance of conducting thorough research.
%            \item realized that patience really is a virtue...
%        \end{itemize}
%    \end{frame}
%
%    \begin{frame}{Returning Home}
%        \centering
%        Thank you! \\ [2ex]
%        \includegraphics[width=1\columnwidth]{interns}
%    \end{frame}
%
\end{document}

